<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced To-Do List</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f2f2f2;
      transition: 0.3s;
    }

    body.dark {
      background: #111;
      color: white;
    }

    h2 {
      margin-bottom: 10px;
    }

    input, select, button {
      padding: 8px;
      margin: 5px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin-top: 10px;
    }

    .task-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 10px;
      background: white;
      margin-bottom: 8px;
      border-radius: 6px;
      transition: 0.3s;
      animation: fadeIn 0.3s;
    }

    body.dark .task-item {
      background: #222;
    }

    .task-item.done .task-text {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .task-buttons {
      display: flex;
      gap: 6px;
      margin-top: 5px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <h2>Advanced To-Do List</h2>

  <!-- Input -->
  <input id="taskInput" placeholder="Enter task...">

  <select id="prioritySelect">
    <option>Low</option>
    <option>Medium</option>
    <option>High</option>
  </select>

  <button id="addBtn">Add</button>
  <button id="clearBtn">Clear All</button>

  <br><br>

  <!-- Search & Sort -->
  <input id="searchInput" placeholder="Search tasks...">

  <select id="sortSelect">
    <option value="az">A → Z</option>
    <option value="za">Z → A</option>
    <option value="done">Completed First</option>
  </select>

  <button id="darkToggle">Dark Mode</button>

  <br><br>

  <!-- Export Import -->
  <button id="exportBtn">Export</button>
  <button id="importBtn">Import</button>
  <input type="file" id="importFile" style="display:none">

  <!-- Counter -->
  <p id="countText"></p>

  <!-- Task List -->
  <ul id="taskList"></ul>


  <!-- JavaScript -->
  <script>
    const input = document.getElementById("taskInput");
    const addBtn = document.getElementById("addBtn");
    const taskList = document.getElementById("taskList");
    const clearBtn = document.getElementById("clearBtn");
    const searchInput = document.getElementById("searchInput");
    const sortSelect = document.getElementById("sortSelect");
    const countText = document.getElementById("countText");
    const darkToggle = document.getElementById("darkToggle");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const importFile = document.getElementById("importFile");

    addBtn.addEventListener("click", addTask);
    clearBtn.addEventListener("click", clearAllTasks);
    searchInput.addEventListener("input", filterTasks);
    sortSelect.addEventListener("change", sortTasks);
    darkToggle.addEventListener("click", () => document.body.classList.toggle("dark"));
    exportBtn.addEventListener("click", exportTasks);
    importBtn.addEventListener("click", () => importFile.click());
    importFile.addEventListener("change", importTasks);

    loadTasks();
    updateCount();

    function addTask() {
      const text = input.value.trim();
      if (text === "") return;

      const priority = document.getElementById("prioritySelect").value;
      const li = createTaskElement(text, priority, new Date().toLocaleString());
      taskList.appendChild(li);

      input.value = "";
      saveTasks();
      updateCount();
    }

    function createTaskElement(text, priority, timestamp) {
      const li = document.createElement("li");
      li.classList.add("task-item");

      const span = document.createElement("span");
      span.textContent = text;
      span.classList.add("task-text");

      span.addEventListener("click", () => {
        li.classList.toggle("done");
        saveTasks();
        updateCount();
      });

      const priorityLabel = document.createElement("small");
      priorityLabel.textContent = `Priority: ${priority}`;

      const timeLabel = document.createElement("small");
      timeLabel.textContent = timestamp;

      const editBtn = document.createElement("button");
      editBtn.textContent = "✏️";
      editBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const newText = prompt("Edit Task:", span.textContent);
        if (newText && newText.trim() !== "") {
          span.textContent = newText.trim();
          saveTasks();
        }
      });

      const delBtn = document.createElement("button");
      delBtn.textContent = "❌";
      delBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        li.remove();
        saveTasks();
        updateCount();
      });

      const buttons = document.createElement("div");
      buttons.classList.add("task-buttons");
      buttons.appendChild(editBtn);
      buttons.appendChild(delBtn);

      li.appendChild(span);
      li.appendChild(priorityLabel);
      li.appendChild(timeLabel);
      li.appendChild(buttons);

      return li;
    }

    function saveTasks() {
      localStorage.setItem("tasks", taskList.innerHTML);
    }

    function loadTasks() {
      const saved = localStorage.getItem("tasks");
      if (saved) {
        taskList.innerHTML = saved;

        [...taskList.children].forEach((li) => {
          const span = li.querySelector(".task-text");

          span.addEventListener("click", () => {
            li.classList.toggle("done");
            saveTasks();
            updateCount();
          });

          const editBtn = li.querySelector("button:first-child");
          editBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            const newText = prompt("Edit Task:", span.textContent);
            if (newText && newText.trim() !== "") {
              span.textContent = newText.trim();
              saveTasks();
            }
          });

          const delBtn = li.querySelector("button:last-child");
          delBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            li.remove();
            saveTasks();
            updateCount();
          });
        });
      }
    }

    function clearAllTasks() {
      taskList.innerHTML = "";
      saveTasks();
      updateCount();
    }

    function filterTasks() {
      const search = searchInput.value.toLowerCase();
      [...taskList.children].forEach((li) => {
        const text = li.querySelector(".task-text").textContent.toLowerCase();
        li.style.display = text.includes(search) ? "block" : "none";
      });
    }

    function sortTasks() {
      const option = sortSelect.value;
      const tasks = [...taskList.children];

      tasks.sort((a, b) => {
        const textA = a.querySelector(".task-text").textContent;
        const textB = b.querySelector(".task-text").textContent;

        switch (option) {
          case "az":
            return textA.localeCompare(textB);
          case "za":
            return textB.localeCompare(textA);
          case "done":
            return a.classList.contains("done") - b.classList.contains("done");
        }
      });

      taskList.innerHTML = "";
      tasks.forEach(t => taskList.appendChild(t));
      saveTasks();
    }

    function updateCount() {
      const total = taskList.children.length;
      const done = [...taskList.children].filter(li => li.classList.contains("done")).length;
      countText.textContent = `Completed: ${done} / Total: ${total}`;
    }

    function exportTasks() {
      const data = taskList.innerHTML;
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");

      a.href = url;
      a.download = "tasks.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importTasks() {
      const file = importFile.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        taskList.innerHTML = reader.result;
        saveTasks();
        loadTasks();
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
